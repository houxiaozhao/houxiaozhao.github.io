---
title: InfluxDBå®è·µï¼šä»MongoDBè¿ç§»åˆ°æ—¶åºæ•°æ®åº“çš„å¼€å‘ä½“éªŒ
date: 2019-03-07 15:00:01.0
categories:
  - æ•°æ®åº“
  - åç«¯å¼€å‘
  - Node.jså¼€å‘
tags:
  - InfluxDB
  - æ—¶åºæ•°æ®åº“
  - Node.js
  - MongoDB
  - æ•°æ®è¿ç§»
  - æ•°æ®ç›‘æ§
  - Ubuntu
  - Grafana
keywords:
  - InfluxDBå®‰è£…
  - æ—¶åºæ•°æ®åº“
  - Node.jsé›†æˆ
  - æ•°æ®ç›‘æ§
  - æ•°æ®è¿ç§»
  - MongoDBæ›¿ä»£
  - èµ„æºç›‘æ§
  - Ubuntuå®‰è£…
  - InfluxDBæŸ¥è¯¢
  - æ•°æ®å¯è§†åŒ–
  - Grafanaé›†æˆ
  - InfluxDBStudio
  - æ—¶é—´åºåˆ—æ•°æ®
  - æ€§èƒ½ç›‘æ§
  - æ•°æ®å­˜å‚¨ä¼˜åŒ–
description: |
  æœ¬æ–‡è¯¦ç»†è®°å½•äº†ä»MongoDBè¿ç§»åˆ°InfluxDBæ—¶åºæ•°æ®åº“çš„å®è·µç»éªŒã€‚é¦–å…ˆä»‹ç»äº†InfluxDBçš„åŸºæœ¬æ¦‚å¿µå’Œç‰¹ç‚¹ï¼Œé‡ç‚¹è¯´æ˜å…¶åœ¨å¤„ç†æ—¶é—´åºåˆ—æ•°æ®å’Œèµ„æºç›‘æ§æ–¹é¢çš„ä¼˜åŠ¿ã€‚æ–‡ç« åˆ†æ­¥éª¤å±•ç¤ºäº†åœ¨Ubuntuç³»ç»Ÿä¸Šå®‰è£…InfluxDBçš„å®Œæ•´è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ·»åŠ è½¯ä»¶æºã€å®‰è£…åŒ…ä»¥åŠæœåŠ¡å¯åŠ¨ã€‚é’ˆå¯¹æ•°æ®æ“ä½œï¼Œæä¾›äº†è¯¦ç»†çš„å‘½ä»¤è¡Œç¤ºä¾‹ï¼Œå±•ç¤ºäº†æ•°æ®åº“åˆ›å»ºã€æ•°æ®æ’å…¥ç­‰åŸºæœ¬æ“ä½œã€‚ç‰¹åˆ«ä»‹ç»äº†ä¸¤æ¬¾å®ç”¨çš„å¯è§†åŒ–å·¥å…·ï¼šInfluxDBStudioå’ŒGrafanaï¼Œå¹¶é…æœ‰ç•Œé¢æˆªå›¾è¯´æ˜å…¶ä½¿ç”¨æ–¹æ³•ã€‚åœ¨Node.jså¼€å‘éƒ¨åˆ†ï¼Œé€šè¿‡å®é™…ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨influxåŒ…è¿æ¥æ•°æ®åº“ã€å®šä¹‰æ•°æ®schemaã€æ’å…¥æ•°æ®ä»¥åŠæ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚æ–‡ç« æœ€åæ€»ç»“äº†è¿ç§»ç»éªŒï¼Œå¹¶æä¾›äº†å®˜æ–¹æ–‡æ¡£ç­‰é‡è¦å‚è€ƒèµ„æºé“¾æ¥ã€‚

  This article documents the practical experience of migrating from MongoDB to InfluxDB time series database. It begins with an introduction to InfluxDB's core concepts and features, highlighting its advantages in handling time series data and resource monitoring. The article provides a step-by-step guide for installing InfluxDB on Ubuntu systems, including adding software repositories, package installation, and service initialization. For data operations, it offers detailed command-line examples demonstrating database creation, data insertion, and basic queries. The article specifically introduces two practical visualization tools: InfluxDBStudio and Grafana, with interface screenshots illustrating their usage. In the Node.js development section, it demonstrates through actual code examples how to use the influx package to connect to the database, define data schemas, insert data, and execute queries. The article concludes with migration insights and provides links to official documentation and important reference resources. The content focuses on practical implementation while maintaining technical accuracy, making it valuable for developers considering similar database migrations or looking to implement time series data solutions.
---

# å‰è¨€

æˆ‘ä¹‹å‰çš„èŠ‚ç‚¹æ•°æ®æ˜¯å…¨éƒ½å­˜åˆ° mongoDB ä¸­çš„ã€‚å¶ç„¶çš„æœºä¼šï¼Œå‘ç°äº† InfluxDB è¿™ç§æ—¶åºæ•°æ®åº“ã€‚äºæ˜¯èŠ±äº†ç‚¹æ—¶é—´ç®€å•ä½¿ç”¨ä¸€äº›ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½æ›¿æ¢ mongoDB å­˜å‚¨å†å²æ•°æ®ã€‚

# InfluxDB ç®€ä»‹

InfluxDB æ˜¯ä¸€ä¸ªå¼€æºæ—¶åºæ•°æ®åº“ã€‚é€‚åˆå¤„ç†åˆ†æèµ„æºæ•°æ®ç›‘æ§ç›¸å…³æ•°æ®ã€‚

[https://docs.influxdata.com/influxdb/v1.6/](https://docs.influxdata.com/influxdb/v1.6/)

  <!--more-->

# å®‰è£…

ç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º v1.6ã€‚

å®‰è£… InfluxDB çš„æ–¹å¼å¾ˆç®€å•(Ubuntu)

    $ curl -sL <https://repos.influxdata.com/influxdb.key> | sudo apt-key add -
    $ source /etc/lsb-release
    $ echo "deb <https://repos.influxdata.com/${DISTRIB_ID,,}> ${DISTRIB_CODENAME} stable" | sudo tee /etc/apt/sources.list.d/influxdb.list
    $ sudo apt-get update && sudo apt-get install influxdb
    $ sudo service influxdb start

å®Œæˆã€‚ğŸ˜‹

ç„¶åå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œè¾“å…¥ influx æ„‰å¿«çš„ç©è€äº†ã€‚

ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºä¸€äº›æ•°æ®

    create database 'mydb'
    use mydb
    insert test,tag1=111,tag2=222 field1=111111,field2=222222

ç„¶åå°±å¯ä»¥æŸ¥è¯¢æ•°æ®ã€‚ç”±äºæ˜¯æ–°æ‰‹ï¼Œå½“ç„¶æ˜¯ä½¿ç”¨å·¥å…·å•¦ã€‚

ä»¥å‰çš„ç‰ˆæœ¬è‡ªå¸¦ä¸€ä¸ª web ç®¡ç†ç•Œé¢ã€‚ç°åœ¨çš„ç‰ˆæœ¬æ²¡æœ‰äº†~

é™„ä¸Šå¯è§†åŒ–å·¥å…·ä¸€æš[https://github.com/CymaticLabs/InfluxDBStudio](https://github.com/CymaticLabs/InfluxDBStudio)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190307145841886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTExMTI3NzM=,size_16,color_FFFFFF,t_70)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190307145901883.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTExMTI3NzM=,size_16,color_FFFFFF,t_70)

æ’å…¥æˆåŠŸ ğŸ˜„ å¯ä»¥çœ‹åˆ°é‡Œé¢é™¤äº†æˆ‘ä»¬è‡ªå·±åŠ çš„ä¸¤ä¸ª tag,ä¸¤ä¸ª field,è¿˜åŒ…æ‹¬ä¸€ä¸ªè‡ªåŠ¨æ·»åŠ çš„ timeã€‚æ¯•ç«Ÿæ˜¯`æ—¶åºæ•°æ®åº“`å˜›ï¼

é™¤äº†ä½¿ç”¨ InfluxDBStudio ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå·¥å…· Grafanaã€‚[https://grafana.com](https://grafana.com/) æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å»æŸ¥æŸ¥ã€‚å—¯ï¼Œå¾ˆç‚«ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190307145928906.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTExMTI3NzM=,size_16,color_FFFFFF,t_70)

# Nodejs ä½¿ç”¨

npm åŒ… [https://www.npmjs.com/package/influx](https://www.npmjs.com/package/influx)

## å®‰è£…

    npm install --save influx@next

## ç¬¬ä¸€æ­¥ æ’å…¥æ•°æ®

    const Influx = require('influx'); //å¯¼åŒ…
    // å®šä¹‰æ•°æ®åº“è¿æ¥å’Œæ•°æ®æ ¼å¼ï¼Œåˆ›å»ºclient
    const client = new Influx.InfluxDB({
      database: 'mydb',
      username: 'root',
      password: 'root',
      hosts: [{ host: 'xx.xx.xx.xxx' }],
      schema: [
        {
          measurement: 'test', //ç±»ä¼¼äºæ•°æ®è¡¨çš„æ¦‚å¿µ
          fields: { //æ•°æ®è¡¨çš„å­—æ®µï¼Œå®šä¹‰ç±»å‹ï¼ŒFLOAT/INTEGER/STRING/BOOLEAN
    			  field1:Influx.FieldType.INTEGER,
    				field2:Influx.FieldType.INTEGER,
          }, // tag ä¹Ÿæ˜¯é‡Œé¢çš„å­—æ®µï¼Œæ˜¯è‡ªå¸¦ç´¢å¼•å…‰ç¯ã€‚æŸ¥è¯¢é€Ÿåº¦æ æ çš„ã€‚
          tags: ['tag1','tag2']
        }
      ]
    });
    // æ’å…¥æ•°æ®
    client.writePoints([
              {
                measurement: 'test',
                fields: {
                  field1:1231123,
    							field2:44233,
                },
                tags: {
                  tag1:14233,
    							tag2:41122
                }
              }
            ])

## ç¬¬äºŒæ­¥ æŸ¥è¯¢æ•°æ®

    const Influx = require('influx');
    // å’Œä¸Šè¾¹ä¸€æ ·ã€‚
    const client = new Influx.InfluxDB({
      database: 'mydb',
      username: 'root',
      password: 'root',
      hosts: [{ host: 'xx.xx.xx.xxx' }],
      schema: [
        {
          measurement: 'test', //ç±»ä¼¼äºæ•°æ®è¡¨çš„æ¦‚å¿µ
          fields: { //æ•°æ®è¡¨çš„å­—æ®µï¼Œå®šä¹‰ç±»å‹ï¼ŒFLOAT/INTEGER/STRING/BOOLEAN
    			  field1:Influx.FieldType.INTEGER,
    				field2:Influx.FieldType.INTEGER,
          }, // tag ä¹Ÿæ˜¯é‡Œé¢çš„å­—æ®µï¼Œæ˜¯è‡ªå¸¦ç´¢å¼•å…‰ç¯ã€‚æŸ¥è¯¢é€Ÿåº¦æ æ çš„ã€‚
          tags: ['tag1','tag2']
        }
      ]
    });
    // è·å–5åˆ†é’Ÿå†…çš„æ•°æ®
    // è‡³äºInfluxçš„æŸ¥è¯¢è¯­æ³•ï¼Œæ®è¯´å’Œmysqlæœ‰ç‚¹ç±»ä¼¼ã€‚è¿˜æ²¡æœ‰å…·ä½“ç ”ç©¶ã€‚ç°åœ¨å°±ç®€å•æŸ¥ä¸€ä¸ªå§
    client
      .query(
        `
        SELECT * FROM "test" WHERE time > now() - 5m
      `
      )
      .then(res => {
        console.log(res); //è¾“å‡ºä¸€ä¸ªæ•°ç»„ã€‚
      });

# æ€»ç»“

åˆ°ç›®å‰ä½ç½®ï¼Œå·²ç»åŸºæœ¬æ»¡è¶³é¡¹ç›®éœ€æ±‚ã€‚æ¥ä¸‹æ¥å°±æ˜¯å„ç§èŠ±å¼æŸ¥è¯¢è€Œå·²ã€‚

## å„ç§é“¾æ¥ ğŸ”—

- [https://docs.influxdata.com/influxdb/v1.6/](https://docs.influxdata.com/influxdb/v1.6/)
- [https://github.com/CymaticLabs/InfluxDBStudio](https://github.com/CymaticLabs/InfluxDBStudio)
- [https://grafana.com](https://grafana.com/)
- [https://www.npmjs.com/package/influx](https://www.npmjs.com/package/influx)
